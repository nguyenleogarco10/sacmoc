<!DOCTYPE html>
<html lang="vi" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sắc Mộc - Vẻ Đẹp Có Trách Nhiệm</title>

    <!-- SEO Meta Tags -->
    <meta name="description" content="Sắc Mộc - Thương hiệu mỹ phẩm Việt cam kết về vẻ đẹp an toàn, tinh khiết và bền vững. Khám phá son môi tự nhiên không hóa chất độc hại.">
    <meta property="og:title" content="Sắc Mộc - Vẻ Đẹp Có Trách Nhiệm">
    <meta property="og:description" content="Sắc Mộc - Thương hiệu mỹ phẩm Việt cam kết về vẻ đẹp an toàn, tinh khiết và bền vững. Khám phá son môi tự nhiên không hóa chất độc hại.">
    <meta property="og:image" content="https://placehold.co/1200x630/5D7A4D/FFFFFF?text=Sac+Moc+Beauty"> <!-- Placeholder, replace with actual image URL -->
    <meta property="og:url" content="https://www.sacmoc.vn"> <!-- Replace with actual website URL -->
    <meta name="twitter:card" content="summary_large_image">

    <!-- Preload fonts for faster loading -->
    <link rel="preload" href="https://fonts.googleapis.com/css2?family=Merriweather+Sans:wght@700&display=swap" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <link rel="preload" href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600&display=swap" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript>
        <link href="https://fonts.googleapis.com/css2?family=Merriweather+Sans:wght@700&family=Open+Sans:wght@400;600&display=swap" rel="stylesheet">
    </noscript>

    <!-- Preload critical scripts -->
    <link rel="preload" href="https://cdn.tailwindcss.com" as="script">
    <link rel="preload" href="https://cdn.jsdelivr.net/npm/chart.js" as="script">
    <link rel="preload" href="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs-core@3.18.0/dist/tf-core.min.js" as="script">
    <link rel="preload" href="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs-converter@3.18.0/dist/tf-converter.min.js" as="script">
    <link rel="preload" href="https://cdn.jsdelivr.net/npm/@tensorflow-models/face-landmarks-detection@1.0.2/dist/face-landmarks-detection.min.js" as="script">


    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs-core@3.18.0/dist/tf-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs-converter@3.18.0/dist/tf-converter.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/face-landmarks-detection@1.0.2/dist/face-landmarks-detection.min.js"></script>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <!-- Updated font to be more in harmony with the logo - 'Merriweather Sans' for headings and 'Open Sans' for body text -->
    <link href="https://fonts.googleapis.com/css2?family=Merriweather+Sans:wght@700&family=Open+Sans:wght@400;600&display=swap" rel="stylesheet">
    <style>
        body {
            /* Changed font-family to Open Sans for general text */
            font-family: 'Open Sans', sans-serif;
            /* Changed background-color to beige */
            background-color: #F5F5DC;
            color: #4A4A4A;
        }
        /* New custom class for headings to use Merriweather Sans */
        .font-heading {
            font-family: 'Merriweather Sans', sans-serif;
        }
        /* Updated brand colors to be closer to the logo's green/brown tones */
        .text-brand { color: #5D7A4D; } /* A darker, earthy green */
        .bg-brand { background-color: #5D7A4D; }
        .bg-brand-light { background-color: #A2B99C; } /* A lighter green */
        .bg-brand-superlight { background-color: #E6EDE4; } /* Very light green */
        .border-brand { border-color: #5D7A4D; }
        
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
            height: 400px;
            max-height: 50vh;
        }
        @media (max-width: 768px) {
            .chart-container {
                height: 500px;
                max-height: 70vh;
            }
        }
        .nav-link {
            transition: color 0.3s ease;
        }
        .nav-link:hover {
            color: #5D7A4D; /* Updated hover color */
        }
        .card-hover {
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .card-hover:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.05), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        
        /* New CSS for testimonial carousel structure */
        .testimonial-viewport {
            overflow: hidden; /* This creates the visible window for testimonials */
            position: relative;
            width: 100%;
            /* Removed scroll-snap-type as it conflicts with JS controlled sliding */
        }

        #testimonial-slider { 
            display: flex;
            transition: transform 0.5s ease-in-out; /* Apply transition to the element being transformed */
            flex-wrap: nowrap; /* Ensure items don't wrap to the next line */
            -webkit-overflow-scrolling: touch; /* For smooth scrolling on iOS */
            /* Width will be set dynamically by JS */
        }
        
        .testimonial-card {
            /* flex-shrink and flex-grow will be set by JS */
            /* width will be set dynamically by JS to ensure proper sizing */
            /* Removed flex-basis and media queries as JS will handle sizing */
        }
         /* PADDING is still relevant for inside the cards */
         .testimonial-card .bg-white {
            padding: 1.5rem; /* Equivalent to p-6 Tailwind class */
         }

        #vto-video-container {
            position: relative;
            width: 100%;
            max-width: 500px; /* Control max size */
            margin: auto;
            aspect-ratio: 4 / 3; /* Maintain aspect ratio */
        }
        #vto-video, #vto-canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border-radius: 0.5rem; /* Tailwind's rounded-lg */
            object-fit: cover; /* Ensure video covers the area */
        }
         #vto-video {
            transform: scaleX(-1); /* Mirror mode for webcam */
        }
        #vto-canvas {
            pointer-events: none; /* Allow interaction with elements below if any */
        }

        /* Hero section background image blur and fade-in effect */
        .hero-background-image {
            filter: blur(8px); /* Initial blur */
            transition: filter 1s ease-out, transform 1s ease-out; /* Smooth transition for blur and zoom */
            transform: scale(1.05); /* Slightly zoomed in */
        }
        .hero-background-image.loaded {
            filter: blur(0); /* No blur after loading */
            transform: scale(1); /* Original scale */
        }

        /* Animation classes for scroll effects */
        .animate-on-scroll {
            opacity: 0;
            /* Default transform for slide-up and zoom-in */
            transform: translateY(20px);
            transition: opacity 0.8s ease-out, transform 0.8s ease-out;
        }

        /* Specific initial states if they differ from the default transform */
        .animate-on-scroll.zoom-in {
            transform: scale(0.95);
        }
        /* No specific transform for fade-in, it just uses opacity */

        /* The class that makes elements visible and resets transform */
        .animate-on-scroll.visible {
            opacity: 1;
            transform: translateY(0); /* Reset for slide-up and default */
        }
        .animate-on-scroll.zoom-in.visible {
            transform: scale(1); /* Reset for zoom-in */
        }
        /* No explicit fade-in.visible needed if it's just opacity */
    </style>
</head>
<body class="antialiased">

    <!-- Header section - Changed 'fixed' to 'relative' to allow scrolling -->
    <header id="header" class="bg-white/80 backdrop-blur-md relative top-0 left-0 right-0 z-50 shadow-sm" role="banner">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <!-- Adjusted header height to accommodate a larger logo -->
            <!-- Height of header increased to h-36 to allow for a larger logo -->
            <div class="flex justify-between items-center h-36"> 
                <div class="flex-shrink-0 flex items-center">
                    <!-- Increased logo size -->
                    <!-- Logo image height increased to h-32 to make it more prominent -->
                    <a href="#hero" class="flex items-center" aria-label="Trang chủ Sắc Mộc">
                        <img src="Logo.png" alt="Sắc Mộc Logo" class="h-32 w-auto"> <!-- Adjust h-32 as needed for size -->
                    </a>
                </div>
                <div class="hidden md:block">
                    <nav class="flex items-center space-x-8" role="navigation" aria-label="Điều hướng chính">
                        <a href="#philosophy" class="text-gray-600 nav-link font-medium" aria-label="Đi đến phần Triết Lý">Triết Lý</a>
                        <a href="#products" class="text-gray-600 nav-link font-medium" aria-label="Đi đến phần Sản Phẩm">Sản Phẩm</a>
                        <a href="#transparency" class="text-gray-600 nav-link font-medium" aria-label="Đi đến phần Minh Bạch">Minh Bạch</a>
                        <a href="#community" class="text-gray-600 nav-link font-medium" aria-label="Đi đến phần Cộng Đồng">Cộng Đồng</a>
                    </nav>
                </div>
                 <div class="md:hidden">
                    <button id="mobile-menu-button" class="text-gray-600 hover:text-brand focus:outline-none" aria-label="Mở menu di động">
                        <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M4 6h16M4 12h16m-7 6h7" />
                        </svg>
                    </button>
                </div>
            </div>
        </div>
        <div id="mobile-menu" class="md:hidden hidden" role="navigation" aria-label="Menu di động">
            <nav class="px-2 pt-2 pb-3 space-y-1 sm:px-3">
                <a href="#philosophy" class="block px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:text-brand hover:bg-gray-50" aria-label="Đi đến phần Triết Lý">Triết Lý</a>
                <a href="#products" class="block px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:text-brand hover:bg-gray-50" aria-label="Đi đến phần Sản Phẩm">Sản Phẩm</a>
                <a href="#transparency" class="block px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:text-brand hover:bg-gray-50" aria-label="Đi đến phần Minh Bạch">Minh Bạch</a>
                <a href="#community" class="block px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:text-brand hover:bg-gray-50" aria-label="Đi đến phần Cộng Đồng">Cộng Đồng</a>
            </nav>
        </div>
    </header>

    <main>
        <!-- Hero section - Dynamic background image with blur/fade -->
        <section id="hero" class="pt-16 h-screen flex items-center bg-cover bg-center relative overflow-hidden" role="region" aria-label="Giới thiệu Sắc Mộc">
            <img src="https://images.unsplash.com/photo-1590431305265-538183495a43?q=80&w=2070&auto=format&fit=crop" 
                 alt="Background image of serene nature" 
                 class="hero-background-image absolute inset-0 w-full h-full object-cover" 
                 onload="this.classList.add('loaded')">
            <!-- Changed overlay to a more transparent beige to blend with the new background -->
            <div class="absolute inset-0 bg-[#F5F5DC]/50"></div>
            <div class="relative max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center animate-on-scroll visible"> <!-- Hero section is visible by default -->
                <!-- Increased font size for the main heading on the banner -->
                <!-- Added gradient text effect for the slogan -->
                <h1 class="text-5xl md:text-7xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-[#5D7A4D] to-[#8CA786] tracking-tight font-heading">Vẻ Đẹp Có Trách Nhiệm</h1> <!-- Applied font-heading here -->
                <p class="mt-4 max-w-2xl mx-auto text-lg md:text-xl text-gray-700">Sắc Mộc không chỉ là son môi. Đó là một lựa chọn an toàn cho bạn, tử tế với hành tinh và cam kết cho một vẻ đẹp minh bạch.</p>
                <div class="mt-8">
                    <a href="#philosophy" class="inline-block bg-brand text-white font-bold py-3 px-8 rounded-full shadow-lg hover:bg-opacity-90 transition-transform transform hover:scale-105" aria-label="Khám phá câu chuyện của Sắc Mộc">Khám Phám Câu Chuyện</a>
                </div>
            </div>
        </section>

        <section id="philosophy" class="py-20 bg-white" role="region" aria-label="Triết lý Sắc Mộc">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="text-center animate-on-scroll slide-up">
                    <h2 class="text-3xl font-bold text-brand font-heading">Triết Lý Sắc Mộc</h2> <!-- Applied font-heading here -->
                    <p class="mt-4 max-w-3xl mx-auto text-lg text-gray-600">Chúng tôi ra đời để giải quyết những lo ngại về sức khỏe và môi trường trong ngành mỹ phẩm. Sắc Mộc là câu trả lời cho nhu cầu về một vẻ đẹp không chỉ rạng rỡ bên ngoài mà còn an tâm từ bên trong.</p>
                </div>
                <div class="mt-16 grid gap-10 md:grid-cols-2 lg:grid-cols-4">
                    <div class="text-center p-6 bg-brand-superlight rounded-xl card-hover animate-on-scroll slide-up" style="transition-delay: 0.1s;">
                        <div class="flex items-center justify-center h-16 w-16 rounded-full bg-brand-light mx-auto text-3xl">
                            <!-- SVG Icon for An Toàn & Tinh Khiết (Safe & Pure) - Leaf -->
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-white" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M17.32 5.09a.75.75 0 011.06 0L20 6.71l-1.68 1.68a.75.75 0 01-1.06 0L17.32 5.09zM12 21.35c-3.78-3.4-7.18-6.8-7.18-11.54 0-3.08 2.42-5.5 5.5-5.5 1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3c3.08 0 5.5 2.42 5.5 5.5 0 3.78-3.4 6.86-8.55 11.54L12 21.35zM9.5 7C7.57 7 6 8.57 6 10.5S7.57 14 9.5 14 13 12.43 13 10.5 11.43 7 9.5 7z"/>
                            </svg>
                        </div>
                        <h3 class="mt-5 text-xl font-semibold text-brand font-heading">An Toàn & Tinh Khiết</h3> <!-- Applied font-heading here -->
                        <p class="mt-2 text-gray-600">Công thức với hơn 95% thành phần tự nhiên, không chứa kim loại nặng, parabens hay hóa chất độc hại.</p>
                    </div>
                    <div class="text-center p-6 bg-brand-superlight rounded-xl card-hover animate-on-scroll slide-up" style="transition-delay: 0.2s;">
                        <div class="flex items-center justify-center h-16 w-16 rounded-full bg-brand-light mx-auto text-3xl">
                            <!-- SVG Icon for Bền Vững & Ý Thức (Sustainable & Conscious) - Globe -->
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-white" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 17.93c-3.95-.71-7-4.22-7-8.93 0-.31.02-.61.04-.92L11 4.07v15.86z"/>
                            </svg>
                        </div>
                        <h3 class="mt-5 text-xl font-semibold text-brand font-heading">Bền Vững & Ý Thức</h3> <!-- Applied font-heading here -->
                        <p class="mt-2 text-gray-600">Bao bì thân thiện môi trường, tái chế được và nguồn nguyên liệu khai thác có đạo đức.</p>
                    </div>
                    <div class="text-center p-6 bg-brand-superlight rounded-xl card-hover animate-on-scroll slide-up" style="transition-delay: 0.3s;">
                         <div class="flex items-center justify-center h-16 w-16 rounded-full bg-brand-light mx-auto text-3xl">
                            <!-- SVG Icon for Minh Bạch & Đạo Đức (Transparent & Ethical) - Heart -->
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-white" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/>
                            </svg>
                        </div>
                        <h3 class="mt-5 text-xl font-semibold text-brand font-heading">Minh Bạch & Đạo Đức</h3> <!-- Applied font-heading here -->
                        <p class="mt-2 text-gray-600">Cam kết 100% không thử nghiệm trên động vật và công khai toàn bộ thành phần sản phẩm.</p>
                    </div>
                     <div class="text-center p-6 bg-brand-superlight rounded-xl card-hover animate-on-scroll slide-up" style="transition-delay: 0.4s;">
                        <div class="flex items-center justify-center h-16 w-16 rounded-full bg-brand-light mx-auto text-3xl">
                            <!-- SVG Icon for Hiệu Suất Vượt Trội (Superior Performance) - Star -->
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-white" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/>
                            </svg>
                        </div>
                        <h3 class="mt-5 text-xl font-semibold text-brand font-heading">Hiệu Suất Vượt Trội</h3> <!-- Applied font-heading here -->
                        <p class="mt-2 text-gray-600">Màu sắc rực rỡ, lâu trôi và chất son mềm mịn. Vẻ đẹp "sạch" không có nghĩa là phải thỏa hiệp.</p>
                    </div>
                </div>

                <div class="mt-20 animate-on-scroll slide-up">
                    <div class="text-center">
                        <h3 class="text-2xl font-bold text-brand font-heading">So Sánh Trực Quan</h3> <!-- Applied font-heading here -->
                        <p class="mt-2 max-w-2xl mx-auto text-md text-gray-600">Một cái nhìn nhanh để thấy sự khác biệt mà Sắc Mộc mang lại cho bạn và cho hành tinh.</p>
                    </div>
                    <div class="mt-8 chart-container">
                        <canvas id="comparisonChart" role="img" aria-label="Biểu đồ so sánh sản phẩm Sắc Mộc với son truyền thống về thành phần, bao bì, thử nghiệm động vật, minh bạch nguồn gốc và hiệu suất."></canvas>
                    </div>
                </div>
            </div>
        </section>

        <section id="products" class="py-20 bg-brand-superlight" role="region" aria-label="Sản phẩm son môi Sắc Mộc">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="text-center animate-on-scroll slide-up">
                    <h2 class="text-3xl font-bold text-brand font-heading">Khám Phá Màu Son Của Bạn</h2> <!-- Applied font-heading here -->
                    <p class="mt-4 max-w-3xl mx-auto text-lg text-gray-600">Tìm kiếm sắc màu hoàn hảo chưa bao giờ dễ dàng hơn. Hãy thử ngay những gam màu lấy cảm hứng từ thiên nhiên của chúng tôi.</p>
                </div>

                <!-- Product list layout adjusted for larger squares -->
                <!-- Changed to 6 columns for large screens to make squares smaller and match thu_son_ao.html -->
                <div class="mt-16 grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-6 lg:gap-8" id="product-list" role="list">
                    <!-- Product items will be dynamically inserted here by JavaScript -->
                </div>

                <div class="mt-12 text-center animate-on-scroll zoom-in">
                     <a href="thu_son_ao.html" class="inline-block bg-white text-brand font-bold py-3 px-8 rounded-full shadow-lg border border-brand-light hover:bg-brand-light hover:text-white transition-all transform hover:scale-105" aria-label="Thử son ảo trực tiếp">
                        Trải Nghiệm Thử Son Ảo (Live)
                    </a>
                </div>
            </div>
        </section>

        <section id="transparency" class="py-20 bg-[#F5F5DC]" role="region" aria-label="Trung tâm minh bạch về thành phần sản phẩm">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="text-center animate-on-scroll slide-up">
                    <h2 class="text-3xl font-bold text-brand font-heading">Trung Tâm Minh Bạch</h2> <!-- Applied font-heading here -->
                    <p class="mt-4 max-w-3xl mx-auto text-lg text-gray-600">Chúng tôi tin vào vẻ đẹp không che giấu. Khám phá câu chuyện đằng sau mỗi thành phần làm nên thỏi son của bạn.</p>
                </div>
                <div id="ingredient-accordion" class="mt-12 max-w-3xl mx-auto space-y-4" role="tablist" aria-orientation="vertical">
                    <!-- Ingredient accordion items will be dynamically inserted here by JavaScript -->
                </div>
            </div>
        </section>

        <section id="community" class="py-20 bg-brand-superlight" role="region" aria-label="Cộng đồng Sắc Mộc">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="text-center animate-on-scroll slide-up">
                    <h2 class="text-3xl font-bold text-brand font-heading">Cộng Đồng Sắc Mộc</h2> <!-- Applied font-heading here -->
                    <p class="mt-4 max-w-3xl mx-auto text-lg text-gray-600">Tham gia cùng hàng ngàn phụ nữ Việt đã lựa chọn vẻ đẹp có ý thức. Chia sẻ khoảnh khắc của bạn với #SacMocBeauty.</p>
                </div>
                <div class="mt-16 relative animate-on-scroll slide-up">
                    <div class="testimonial-viewport" role="group" aria-label="Lời chứng thực của khách hàng"> <!-- Wrapper for overflow and snap -->
                        <div id="testimonial-slider" role="presentation"> <!-- This now acts as the flex container for cards -->
                            <!-- Testimonial cards will be dynamically inserted here by JavaScript -->
                        </div>
                    </div>
                    <button id="prev-testimonial" class="absolute left-0 top-1/2 transform -translate-y-1/2 -translate-x-1/2 bg-white/70 hover:bg-white text-brand p-3 rounded-full shadow-md z-10" aria-label="Xem lời chứng thực trước">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor" class="w-6 h-6">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 19.5L8.25 12l7.5-7.5" />
                        </svg>
                    </button>
                    <button id="next-testimonial" class="absolute right-0 top-1/2 transform -translate-y-1/2 translate-x-1/2 bg-white/70 hover:bg-white text-brand p-3 rounded-full shadow-md z-10" aria-label="Xem lời chứng thực tiếp theo">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor" class="w-6 h-6">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M8.25 4.5l7.5 7.5-7.5 7.5" />
                        </svg>
                    </button>
                </div>
            </div>
        </section>
    </main>

    <footer class="bg-gray-800 text-white py-12" role="contentinfo">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
            <h3 class="text-2xl font-bold font-heading">Sắc Mộc</h3> <!-- Applied font-heading here -->
            <p class="mt-2">Vẻ Đẹp Có Trách Nhiệm</p>
            <div class="mt-6 flex justify-center space-x-6">
                <!-- Updated Facebook link to the specified URL -->
                <a href="https://www.facebook.com/profile.php?id=61576617677748" class="hover:text-brand-light" aria-label="Theo dõi chúng tôi trên Facebook" target="_blank" rel="noopener noreferrer">Facebook</a>
                <a href="#" class="hover:text-brand-light" aria-label="Theo dõi chúng tôi trên Instagram">Instagram</a>
                <a href="#" class="hover:text-brand-light" aria-label="Theo dõi chúng tôi trên Tiktok">Tiktok</a>
            </div>
            <p class="mt-6 text-sm text-gray-400">&copy; 2025 Sắc Mộc Việt Nam. All rights reserved.</p>
        </div>
    </footer>

    <div id="vto-modal" class="fixed inset-0 bg-black bg-opacity-50 z-[60] hidden flex items-center justify-center p-4" role="dialog" aria-modal="true" aria-labelledby="vto-modal-title">
        <!-- Changed modal background to beige -->
        <div class="bg-[#F5F5DC] rounded-lg shadow-xl p-6 w-full max-w-4xl relative transform transition-all duration-300 scale-95">
            <button id="close-vto-modal" class="absolute top-4 right-4 text-gray-500 hover:text-gray-800 z-10" aria-label="Đóng cửa sổ thử son ảo">&times;</button>
            <h3 id="vto-modal-title" class="text-2xl font-bold text-brand text-center mb-4 font-heading">Trải Nghiệm Thử Son Ảo</h3> <!-- Applied font-heading here -->
            <div class="grid md:grid-cols-2 gap-6 items-start">
                <div id="vto-video-container" class="bg-gray-200 rounded-lg flex items-center justify-center">
                    <video id="vto-video" playsinline autoplay muted class="rounded-lg"></video>
                    <canvas id="vto-canvas" class="rounded-lg"></canvas>
                    <p id="vto-status" class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 text-gray-600 bg-white/70 p-2 rounded">Đang tải model và khởi động webcam...</p>
                </div>
                <div class="pt-4 md:pt-0">
                    <h4 class="font-semibold text-gray-700 mb-2">Chọn màu son của bạn:</h4>
                    <div id="vto-color-options" class="grid grid-cols-3 sm:grid-cols-4 gap-3" role="group" aria-label="Lựa chọn màu son">
                        <!-- Color options will be dynamically inserted here by JavaScript -->
                    </div>
                    <div class="mt-4 p-3 bg-amber-100 border-l-4 border-amber-500 text-amber-700 text-sm">
                        <p><strong>Lưu ý:</strong> Để có kết quả tốt nhất, hãy đảm bảo khuôn mặt bạn được chiếu sáng đủ và nhìn thẳng vào webcam.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Mobile menu toggle
            const mobileMenuButton = document.getElementById('mobile-menu-button');
            const mobileMenu = document.getElementById('mobile-menu');

            mobileMenuButton.addEventListener('click', () => {
                mobileMenu.classList.toggle('hidden');
            });
            
            // Smooth scroll for anchor links and close mobile menu on click
            document.querySelectorAll('#mobile-menu a, header a[href^="#"]').forEach(link => {
                link.addEventListener('click', (e) => {
                    if (link.closest('#mobile-menu')) mobileMenu.classList.add('hidden'); // Close mobile menu
                    const targetId = link.getAttribute('href');
                    if (targetId.startsWith('#')) { // Check if it's an anchor link
                        e.preventDefault();
                        document.querySelector(targetId).scrollIntoView({ behavior: 'smooth'});
                    }
                    // If it's not an anchor link (e.g., href="thu_son_ao.html"), let the default behavior happen
                });
            });

            // Intersection Observer for scroll animations
            const observerOptions = {
                root: null, // viewport
                rootMargin: '0px',
                threshold: 0.1 // Trigger when 10% of the element is visible
            };

            const observer = new IntersectionObserver((entries, observer) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.classList.add('visible');
                        observer.unobserve(entry.target); // Stop observing once animated
                    }
                });
            }, observerOptions);

            // Observe existing static elements
            document.querySelectorAll('.animate-on-scroll').forEach(element => {
                // If element is already in viewport on load, make it visible immediately
                if (element.getBoundingClientRect().top < window.innerHeight) {
                    element.classList.add('visible');
                } else {
                    // Otherwise, observe it for when it comes into view
                    observer.observe(element);
                }
            });


            // Comparison Chart
            const comparisonChartCtx = document.getElementById('comparisonChart').getContext('2d');
            new Chart(comparisonChartCtx, {
                type: 'bar',
                data: {
                    labels: ['Thành Phần', 'Bao Bì', 'Thử Nghiệm Động Vật', 'Minh Bạch Nguồn Gốc', 'Hiệu Suất'],
                    datasets: [{
                        label: 'Son Truyền Thống',
                        data: [4, 2, 3, 2, 8], // Example scores
                        backgroundColor: '#A2B99C', // bg-brand-light
                        borderColor: '#8CA786',
                        borderWidth: 1
                    }, {
                        label: 'Sắc Mộc',
                        data: [9, 8, 10, 10, 9], // Example scores for Sac Moc
                        backgroundColor: '#5D7A4D', // bg-brand
                        borderColor: '#4D643E',
                        borderWidth: 1
                    }]
                },
                options: {
                    indexAxis: 'y', // Horizontal bar chart
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: {
                            beginAtZero: true,
                            max: 10 // Assuming scores are out of 10
                        },
                        y: {
                            ticks: {
                                font: {
                                    size: 12 // Adjust font size if needed
                                }
                            }
                        }
                    }
                }
            });

            // Products Data - Cấu trúc dữ liệu đã được cập nhật
            const products = [
                { displayName: 'Đỏ Đất', fullName: 'Đỏ Đất - 01', color: '#B95C50', hexOpacity: 'B95C50B3' },
                { displayName: 'Cam Cháy', fullName: 'Cam Cháy - 02', color: '#D87C4F', hexOpacity: 'D87C4FB3' },
                { displayName: 'Hồng Đào', fullName: 'Hồng Đào - 03', color: '#E48F82', hexOpacity: 'E48F82B3' },
                { displayName: 'Nâu Gỗ', fullName: 'Nâu Gỗ - 04', color: '#8C5A4D', hexOpacity: '8C5A4DB3' },
                { displayName: 'Hồng Đất', fullName: 'Hồng Đất - 05', color: '#C68582', hexOpacity: 'C68582B3' },
                { displayName: 'Đỏ Ruby', fullName: 'Đỏ Ruby - 06', color: '#9B1C1C', hexOpacity: '9B1C1CB3' },
                { displayName: 'Hồng Cam', fullName: 'Hồng Cam - 07', color: '#FF7F50', hexOpacity: 'FF7F50B3' },
                { displayName: 'Đỏ Rượu Vang', fullName: 'Đỏ Rượu Vang - 08', color: '#800020', hexOpacity: '800020B3' },
                { displayName: 'Hồng Fuchsia', fullName: 'Hồng Fuchsia - 09', color: '#C154C1', hexOpacity: 'C154C1B3' },
                { displayName: 'Nude Đào', fullName: 'Nude Đào - 10', color: '#F7CAC9', hexOpacity: 'F7CAC9B3' },
                { displayName: 'Mận Chín', fullName: 'Mận Chín - 11', color: '#8E4585', hexOpacity: '8E4585B3' },
                { displayName: 'Hồng Tím', fullName: 'Hồng Tím - 12', color: '#C8A2C8', hexOpacity: 'C8A2C8B3' } 
            ];

            // Populate Product List - Logic hiển thị sản phẩm đã được cập nhật
            const productList = document.getElementById('product-list');
            productList.innerHTML = ''; // Xóa nội dung cũ trước khi thêm mới
            products.forEach(p => {
                const card = document.createElement('div');
                // Added role="listitem" for accessibility
                card.className = 'group text-center animate-on-scroll zoom-in'; // Container for each product card, centered text
                card.innerHTML = `
                    <div class="relative w-full aspect-square rounded-lg overflow-hidden card-hover" aria-label="Sản phẩm son ${p.displayName}">
                        <div class="absolute inset-0 flex items-center justify-center" style="background-color: ${p.color};">
                            <h3 class="text-white text-2xl font-bold font-heading px-2 py-1">${p.displayName}</h3> 
                        </div>
                    </div>
                    <div class="mt-3"> <!-- Container for full name and small color circle, with top margin -->
                        <h4 class="font-semibold text-gray-800">${p.fullName}</h4>
                        <div class="w-5 h-5 rounded-full mx-auto mt-2 border border-gray-300" style="background-color: ${p.color};" aria-hidden="true"></div>
                    </div>
                `;
                productList.appendChild(card);
                // Observe dynamically added card after it's appended
                if (card.getBoundingClientRect().top < window.innerHeight) {
                    card.classList.add('visible');
                } else {
                    observer.observe(card); 
                }
            });

            // Ingredients Accordion Data
            const ingredientsData = [
                { name: 'Dầu Jojoba Hữu Cơ', description: 'Giàu Vitamin E, hoạt động như một chất dưỡng ẩm tự nhiên, giúp môi mềm mại và căng mọng. Nguồn gốc từ các trang trại hữu cơ bền vững.' },
                { name: 'Bơ Hạt Mỡ', description: 'Cung cấp độ ẩm sâu, làm dịu và phục hồi đôi môi khô, nứt nẻ. Được thu mua công bằng từ các hợp tác xã phụ nữ ở Tây Phi.' },
                { name: 'Sáp Candelilla', description: 'Một loại sáp thực vật thay thế cho sáp ong, tạo độ cứng và bóng cho son môi. Thu hoạch từ cây Candelilla ở sa mạc Chihuahuan.'},
                { name: 'Màu Khoáng Thiên Nhiên', description: 'Sử dụng oxit sắt và mica được khai thác có đạo đức thay cho thuốc nhuộm tổng hợp, đảm bảo màu sắc an toàn và rực rỡ.'}
            ];

            // Populate Ingredient Accordion
            const accordion = document.getElementById('ingredient-accordion');
            accordion.innerHTML = ''; // Clear existing content
            ingredientsData.forEach((ing, index) => {
                const item = document.createElement('div');
                item.className = 'border border-gray-200 rounded-lg overflow-hidden animate-on-scroll slide-up'; // Added animation class
                item.style.transitionDelay = `${index * 0.1}s`; // Stagger delay for each item
                item.innerHTML = `
                    <button class="accordion-button w-full text-left p-4 bg-brand-superlight hover:bg-brand-light transition duration-300 flex justify-between items-center" 
                            id="accordion-header-${index}" 
                            aria-expanded="false" 
                            aria-controls="accordion-content-${index}" 
                            role="tab" 
                            tabindex="0" 
                            aria-label="Thông tin chi tiết về ${ing.name}">
                        <span class="font-semibold text-brand">${ing.name}</span>
                        <span class="accordion-icon text-brand font-bold">+</span>
                    </button>
                    <div class="accordion-content hidden p-4 bg-[#F5F5DC]" 
                         id="accordion-content-${index}" 
                         role="tabpanel" 
                         aria-labelledby="accordion-header-${index}">
                        <p class="text-gray-600">${ing.description}</p>
                    </div>
                `;
                accordion.appendChild(item);
                // Observe dynamically added accordion item after it's appended
                if (item.getBoundingClientRect().top < window.innerHeight) {
                    item.classList.add('visible');
                } else {
                    observer.observe(item);
                }
            });
            
            // Accordion Functionality
            accordion.addEventListener('click', function(e) {
                const button = e.target.closest('.accordion-button');
                if (button) {
                    const content = button.nextElementSibling;
                    const icon = button.querySelector('.accordion-icon');
                    const isHidden = content.classList.contains('hidden');
                    
                    // Close all other accordions
                    document.querySelectorAll('#ingredient-accordion .accordion-content').forEach(c => {
                        c.classList.add('hidden');
                        c.setAttribute('aria-hidden', 'true');
                    });
                    document.querySelectorAll('#ingredient-accordion .accordion-button').forEach(btn => {
                        btn.setAttribute('aria-expanded', 'false');
                        btn.querySelector('.accordion-icon').textContent = '+';
                    });
                    
                    // Toggle current accordion
                    if (isHidden) {
                        content.classList.remove('hidden');
                        content.setAttribute('aria-hidden', 'false');
                        button.setAttribute('aria-expanded', 'true');
                        icon.textContent = '-';
                    } else {
                        // If it was already open and clicked, close it
                        content.classList.add('hidden');
                        content.setAttribute('aria-hidden', 'true');
                        button.setAttribute('aria-expanded', 'false');
                        icon.textContent = '+';
                    }
                }
            });

            // Testimonials Data - Added more testimonials here for a better loop experience
            const testimonials = [
                { text: "Lần đầu tiên mình tìm được một thỏi son vừa đẹp, vừa lâu trôi mà lại an tâm về thành phần. Yêu Sắc Mộc!", author: "An Nhiên, TP.HCM" },
                { text: "Mình đang mang thai nên rất kỹ tính. Sắc Mộc là cứu tinh, giúp mình vẫn xinh đẹp mà không lo ảnh hưởng đến bé.", author: "Minh Thư, Hà Nội" },
                { text: "Thích nhất là bao bì! Vừa đẹp vừa thân thiện môi trường. Một thương hiệu Việt Nam quá tự hào.", author: "Quỳnh Anh, Đà Nẵng" },
                { text: "Màu son lên chuẩn, chất son mềm mịn không gây khô môi. Sẽ ủng hộ Sắc Mộc dài dài.", author: "Ngọc Hà, Hải Phòng" },
                { text: "Tìm kiếm mãi mới được một brand son 'sạch' đúng nghĩa. Rất hài lòng với chất lượng sản phẩm.", author: "Thu Trang, Cần Thơ" },
                { text: "Từ ngày dùng Sắc Mộc, mình không còn lo lắng về chì hay hóa chất độc hại nữa. Cảm ơn thương hiệu!", author: "Phương Vy, Bình Dương" },
                { text: "Son Sắc Mộc màu lên chuẩn, mềm môi, không hề gây bết dính. Dùng hàng ngày rất tiện lợi và an toàn.", author: "Hoàng Yến, Cần Thơ" },
                { text: "Trước giờ mình luôn tìm kiếm sản phẩm thuần chay, và Sắc Mộc đã vượt xa mong đợi của mình. Chất lượng tuyệt vời!", author: "Vân Anh, Long An" },
                { text: "Thực sự bất ngờ với độ bền màu và dưỡng ẩm của son Sắc Mộc. Rất đáng để thử!", author: "Kim Chi, Khánh Hòa" },
                { text: "Bao bì thân thiện môi trường là điểm cộng lớn. Mình rất vui khi ủng hộ một thương hiệu có trách nhiệm.", author: "Thanh Mai, Bình Thuận" },
                { text: "Son lên màu tự nhiên, phù hợp để đi làm hoặc đi chơi. Rất thích sự nhẹ nhàng và an toàn của sản phẩm.", author: "Hương Giang, Đồng Nai" },
                { text: "Chất son mịn màng như bơ, không gây khô môi chút nào. Sắc Mộc là lựa chọn hoàn hảo cho những cô nàng bận rộn.", author: "Thùy Linh, Vũng Tàu" },
                { text: "Rất ấn tượng với cam kết minh bạch thành phần của Sắc Mộc. Giờ đây mình có thể yên tâm sử dụng mỗi ngày.", author: "Diệu Hoa, Nghệ An" },
                { text: "Màu sắc rất trendy và đa dạng, mình có thể tìm thấy mọi tông màu yêu thích tại Sắc Mộc.", author: "Mai Phương, Huế" },
                { text: "Mình đã giới thiệu Sắc Mộc cho tất cả bạn bè và mọi người đều rất hài lòng. Sản phẩm chất lượng cao và an toàn.", author: "Khánh Ly, Thái Bình" , image: "https://placehold.co/150x150/A2B99C/FFFFFF?text=Khánh+Ly"},
                { text: "Yêu thích sự tự nhiên và dịu nhẹ của Sắc Mộc. Không hề gây kích ứng hay nặng môi như các loại son khác.", author: "Trang Anh, Phú Thọ" , image: "https://placehold.2o/150x150/A2B99C/FFFFFF?text=Trang+Anh"},
                { text: "Son môi của Sắc Mộc có mùi thơm nhẹ nhàng, không gây khó chịu, rất phù hợp cho những ai nhạy cảm với mùi hương.", author: "Linh Chi, Vĩnh Phúc" },
                { text: "Mình rất thích cách Sắc Mộc chú trọng đến nguyên liệu tự nhiên. Son dùng an toàn mà vẫn giữ được màu sắc tươi tắn.", author: "Quỳnh Hương, Bắc Ninh" },
                { text: "Thiết kế bao bì sang trọng và tinh tế, cầm rất chắc tay. Sắc Mộc không chỉ là son mà còn là phụ kiện thời trang.", author: "Nguyệt Ánh, Thanh Hóa" },
                { text: "Chất lượng son vượt trội so với mức giá. Mình đã thử nhiều loại son tự nhiên nhưng Sắc Mộc thực sự khác biệt.", author: "Hồng Nhung, Nam Định" },
                { text: "Sắc Mộc đã thay đổi quan điểm của mình về son môi. Vừa đẹp, vừa an toàn, không còn phải lo lắng về tác động xấu nữa.", author: "Thanh Trúc, Bình Định" },
                { text: "Mình rất ấn tượng với dịch vụ chăm sóc khách hàng của Sắc Mộc. Họ rất nhiệt tình và chu đáo.", author: "Thu Thảo, Vĩnh Long" },
                { text: "Màu son lên rất tự nhiên, giúp mình tự tin hơn mỗi ngày. Sắc Mộc là lựa chọn hoàn hảo cho phong cách 'no makeup' của mình.", author: "Mỹ Linh, Tiền Giang" },
                { text: "Đây là thỏi son đầu tiên mình dùng hết. Rất yêu thích chất son và màu sắc của Sắc Mộc.", author: "Kim Ngân, Bến Tre" },
                { text: "Sản phẩm thuần chay, không thử nghiệm trên động vật là điều mình đánh giá cao nhất ở Sắc Mộc. Vẻ đẹp có trách nhiệm thực sự!", author: "Gia Hân, Đồng Tháp" },
                { text: "Chất son mềm mịn, không gây bết dính. Mình có thể dùng Sắc Mộc cả ngày mà không lo khô môi.", author: "Hải Yến, An Giang" }
            ];

            // Populate Testimonial Slider
            const testimonialSlider = document.getElementById('testimonial-slider');
            testimonialSlider.innerHTML = ''; // Clear existing content
            testimonials.forEach(t => {
                const card = document.createElement('div');
                // Added role="group" and aria-roledescription="slide" for accessibility
                card.className = 'testimonial-card p-4 md:p-6'; // Added padding for spacing
                card.innerHTML = `
                    <div class="bg-white p-6 rounded-xl shadow-sm text-center h-full flex flex-col justify-center card-hover" role="group" aria-roledescription="slide">
                        <p class="text-gray-600 italic text-lg">"${t.text}"</p>
                        <h4 class="mt-4 font-bold text-brand">- ${t.author}</h4>
                    </div>
                `;
                testimonialSlider.appendChild(card);
            });

            // Testimonial Slider Functionality
            const prevTestimonialBtn = document.getElementById('prev-testimonial');
            const nextTestimonialBtn = document.getElementById('next-testimonial');
            let currentTestimonialIndex = 0;

            function getVisibleCardsCount() {
                if (window.innerWidth >= 1024) return 3; // lg
                if (window.innerWidth >= 768) return 2; // md
                return 1; // sm and smaller
            }

            function showTestimonials() {
                if (testimonials.length === 0) {
                    testimonialSlider.style.transform = `translateX(0px)`;
                    return;
                }
                
                const visibleCards = getVisibleCardsCount();
                const viewportWidth = testimonialSlider.parentElement.offsetWidth; // Get the width of the .testimonial-viewport
                
                // Calculate the width for each individual card to fit precisely within the viewport
                const individualCardDisplayWidth = viewportWidth / visibleCards;

                // Apply calculated width to each testimonial card and ensure it doesn't shrink
                testimonialSlider.querySelectorAll('.testimonial-card').forEach(card => {
                    card.style.width = `${individualCardDisplayWidth}px`;
                    card.style.flexShrink = '0'; 
                });

                // Set the total width of the slider to accommodate all cards side-by-side
                testimonialSlider.style.width = `${testimonials.length * individualCardDisplayWidth}px`;

                // Apply the transform to slide the cards
                testimonialSlider.style.transform = `translateX(-${currentTestimonialIndex * individualCardDisplayWidth}px)`;
                
                // Buttons are always enabled for infinite loop
                prevTestimonialBtn.disabled = false;
                nextTestimonialBtn.disabled = false;
            }

            nextTestimonialBtn.addEventListener('click', () => {
                const totalCards = testimonials.length;
                const visibleCards = getVisibleCardsCount();
                // If at the end, loop back to the start
                if (currentTestimonialIndex >= totalCards - visibleCards) {
                    currentTestimonialIndex = 0;
                } else {
                    currentTestimonialIndex++;
                }
                showTestimonials();
            });
            prevTestimonialBtn.addEventListener('click', () => {
                const totalCards = testimonials.length;
                const visibleCards = getVisibleCardsCount();
                // If at the beginning, loop to the end
                if (currentTestimonialIndex === 0) {
                    currentTestimonialIndex = totalCards - visibleCards;
                    // Ensure index is not negative if totalCards is less than visibleCards
                    if (currentTestimonialIndex < 0) currentTestimonialIndex = 0;
                } else {
                    currentTestimonialIndex--;
                }
                showTestimonials();
            });
            window.addEventListener('resize', () => {
                // Reset index on resize to prevent awkward jumps if number of visible cards changes
                currentTestimonialIndex = 0;
                showTestimonials();
            });
            
            // Call showTestimonials after all DOM content is loaded and cards are rendered
            // Using a short timeout to ensure card widths are fully calculated by browser
            setTimeout(showTestimonials, 100);

            // VTO (Virtual Try-On) Modal Logic
            const vtoModal = document.getElementById('vto-modal');
            const openVtoModalLink = document.querySelector('a[href="thu_son_ao.html"]'); 
            const closeVtoModalBtn = document.getElementById('close-vto-modal');
            const vtoVideo = document.getElementById('vto-video');
            const vtoCanvas = document.getElementById('vto-canvas');
            const vtoCtx = vtoCanvas.getContext('2d');
            const vtoColorOptions = document.getElementById('vto-color-options');
            const vtoStatus = document.getElementById('vto-status');

            let faceLandmarksModel;
            let currentLipColor = 'rgba(185, 92, 80, 0.7)'; // Default: Đỏ Đất with opacity
            let videoStream;
            let animationFrameId;

            // Precise lip landmark indices for TensorFlow.js Face Landmarks Detection model
            const LIP_LANDMARKS = {
                // Outer contour of the lips
                upperLipOuter: [61, 185, 40, 39, 37, 0, 267, 269, 270, 409, 291],
                lowerLipOuter: [291, 375, 321, 405, 314, 17, 84, 181, 91, 146, 61],
                // Inner contour of the lips (can be used for more detailed rendering)
                upperLipInner: [78, 191, 80, 81, 82, 13, 312, 311, 310, 415, 308],
                lowerLipInner: [308, 324, 318, 402, 317, 14, 87, 178, 88, 95, 78]
            };


            async function setupWebcam() {
                try {
                    videoStream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: 'user' }, audio: false });
                    vtoVideo.srcObject = videoStream;
                    return new Promise((resolve) => {
                        vtoVideo.onloadedmetadata = () => resolve(true);
                    });
                } catch (err) {
                    console.error("Error accessing webcam:", err);
                    vtoStatus.textContent = "Không thể truy cập webcam. Vui lòng cấp quyền.";
                    return false;
                }
            }

            async function loadFaceLandmarksModel() {
                vtoStatus.textContent = "Đang tải model AI...";
                try {
                    await tf.setBackend('webgl'); // Ensure WebGL backend is used for performance
                    faceLandmarksModel = await faceLandmarksDetection.load(
                        faceLandmarksDetection.SupportedPackages.mediapipeFacemesh,
                        { maxFaces: 1, shouldLoadIrisModel: false } // Iris model not needed for lips
                    );
                    vtoStatus.textContent = "Model đã sẵn sàng. Đang chờ webcam...";
                } catch (error) {
                     console.error("Error loading model:", error);
                     vtoStatus.textContent = "Lỗi tải model AI.";
                }
            }
            
            function hexToRgbaWithOpacity(hexWithOpacity) {
                // Assuming hexWithOpacity is like 'B95C50B3' (RRGGBBAA)
                const r = parseInt(hexWithOpacity.slice(0, 2), 16);
                const g = parseInt(hexWithOpacity.slice(2, 4), 16);
                const b = parseInt(hexWithOpacity.slice(4, 6), 16);
                const a = parseInt(hexWithOpacity.slice(6, 8), 16) / 255; // Convert AA to 0-1 alpha
                return `rgba(${r}, ${g}, ${b}, ${a})`;
            }

            function drawLipstick(predictions) {
                vtoCtx.clearRect(0, 0, vtoCanvas.width, vtoCanvas.height); // Clear previous frame
                if (predictions && predictions.length > 0) {
                    const keypoints = predictions[0].scaledMesh; // Use scaledMesh for coordinates relative to video size
                    
                    vtoCtx.fillStyle = currentLipColor;
                    
                    // Combine upper and lower lip outer contours for a single filled path
                    const lipPath = new Path2D();
                    
                    // Upper lip outer
                    const upperOuterPoints = LIP_LANDMARKS.upperLipOuter.map(idx => ({x: keypoints[idx][0], y: keypoints[idx][1]}));
                    lipPath.moveTo(upperOuterPoints[0].x, upperOuterPoints[0].y);
                    for (let i = 1; i < upperOuterPoints.length; i++) {
                        lipPath.lineTo(upperOuterPoints[i].x, upperOuterPoints[i].y);
                    }

                    // Lower lip outer (connects from the end of upperLipOuter)
                    // Ensure smooth connection. The last point of upperLipOuter (291) is the first of lowerLipOuter.
                    const lowerOuterPoints = LIP_LANDMARKS.lowerLipOuter.slice(1).map(idx => ({x: keypoints[idx][0], y: keypoints[idx][1]})); // slice(1) to avoid repeating point 291
                    for (let i = 0; i < lowerOuterPoints.length; i++) {
                        lipPath.lineTo(lowerOuterPoints[i].x, lowerOuterPoints[i].y);
                    }
                    lipPath.closePath(); // Close the path to form a complete shape
                    vtoCtx.fill(lipPath);

                    vtoStatus.style.display = 'none'; // Hide status if drawing is successful
                } else {
                    // No face detected
                    vtoStatus.textContent = "Không tìm thấy khuôn mặt.";
                    vtoStatus.style.display = 'block';
                }
            }

            async function detectionLoop() {
                if (faceLandmarksModel && vtoVideo.readyState >= HTMLMediaElement.HAVE_ENOUGH_DATA) {
                    const predictions = await faceLandmarksModel.estimateFaces({ input: vtoVideo });
                    drawLipstick(predictions);
                }
                animationFrameId = requestAnimationFrame(detectionLoop);
            }

            async function startVTO() {
                // This function is called when the modal opens
                if (!faceLandmarksModel) { // Load model only if not already loaded
                    await loadFaceLandmarksModel();
                    if (!faceLandmarksModel) return; // Exit if model loading failed
                }
                
                const webcamReady = await setupWebcam();
                if (!webcamReady) return;

                vtoVideo.play();
                // Ensure canvas dimensions are set once video metadata is loaded
                vtoVideo.onloadedmetadata = () => {
                    vtoCanvas.width = vtoVideo.videoWidth;
                    vtoCanvas.height = vtoVideo.videoHeight;
                    vtoStatus.textContent = "Đang nhận diện...";
                    if (animationFrameId) cancelAnimationFrame(animationFrameId); // Cancel any existing loop
                    detectionLoop(); // Start the detection loop
                };
                // If metadata is already loaded (e.g., webcam was previously used)
                if (vtoVideo.readyState >= HTMLMediaElement.HAVE_METADATA) {
                   if(vtoVideo.onloadedmetadata && typeof vtoVideo.onloadedmetadata === 'function') vtoVideo.onloadedmetadata();
                }
            }

            function stopVTO() {
                // This function is called when the modal closes
                if (animationFrameId) {
                    cancelAnimationFrame(animationFrameId);
                    animationFrameId = null;
                }
                if (videoStream) {
                    videoStream.getTracks().forEach(track => track.stop()); // Stop webcam tracks
                    videoStream = null;
                }
                vtoVideo.srcObject = null; // Release video object
                if (vtoCtx) { 
                    vtoCtx.clearRect(0, 0, vtoCanvas.width, vtoCanvas.height); // Clear canvas
                }
                vtoStatus.textContent = "Đang tải model và khởi động webcam..."; // Reset status
                vtoStatus.style.display = 'block';
            }

            // Event listener for the "Trải Nghiệm Thử Son Ảo (Live)" link
            // This link will navigate to thu_son_ao.html. The VTO modal is still present
            // in index.html for potential direct integration if a button on this page were to open it.
            
            // Close modal button
            if (closeVtoModalBtn) { 
                closeVtoModalBtn.addEventListener('click', () => {
                    if (vtoModal.querySelector('div')) { 
                        vtoModal.querySelector('div').classList.add('scale-95'); // Animate out
                    }
                    setTimeout(() => vtoModal.classList.add('hidden'), 300);
                    stopVTO();
                });
            }
            
            // Close modal if clicking outside content
            if (vtoModal) { 
                vtoModal.addEventListener('click', function(e) { 
                    if(e.target === vtoModal){ // Check if the click is on the backdrop
                        if (closeVtoModalBtn) closeVtoModalBtn.click(); 
                    }
                });
            }

            // Populate VTO color options (for the modal on this page)
            // Lặp qua các sản phẩm đã được cấu trúc lại để tạo nút chọn màu
            products.forEach(p => {
                const colorBtn = document.createElement('button');
                colorBtn.className = 'vto-color-btn w-full h-12 sm:h-16 rounded-lg border-2 border-transparent hover:border-brand focus:border-brand focus:ring-2 focus:ring-brand-light outline-none';
                colorBtn.style.backgroundColor = p.color; // Use the solid color for the button itself
                colorBtn.dataset.colorHexOpacity = p.hexOpacity; // Store the color with opacity for drawing
                colorBtn.setAttribute('aria-label', `Thử màu ${p.displayName}`); // Sử dụng displayName cho aria-label
                colorBtn.addEventListener('click', () => {
                    currentLipColor = hexToRgbaWithOpacity(p.hexOpacity); // Update the drawing color
                     document.querySelectorAll('#vto-color-options .vto-color-btn').forEach(btn => btn.classList.remove('ring-2', 'ring-brand'));
                     colorBtn.classList.add('ring-2', 'ring-brand'); // Highlight selected selected
                });
                if (vtoColorOptions) { 
                    vtoColorOptions.appendChild(colorBtn);
                }
            });
            
            // Select the first color by default for the modal
            if (vtoColorOptions) { 
                const firstColorButton = vtoColorOptions.firstElementChild;
                if (firstColorButton && typeof firstColorButton.click === 'function') {  
                    firstColorButton.click();
                }
            }
        });
    </script>
</body>
</html>
